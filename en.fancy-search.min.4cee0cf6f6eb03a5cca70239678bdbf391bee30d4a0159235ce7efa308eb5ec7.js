'use strict';(function(a,d){a.addEvent=function(a,b,c){a.attachEvent?a.attachEvent('on'+b,c):a.addEventListener(b,c)},a.removeEvent=function(a,b,c){a.detachEvent?a.detachEvent('on'+b,c):a.removeEventListener(b,c)},a.onReady=function(a){document.readyState!='loading'?a():document.addEventListener?document.addEventListener('DOMContentLoaded',a):document.attachEvent('onreadystatechange',function(){document.readyState=='complete'&&a()})};const e=document.getElementById('search-input');function b(){var a=new XMLHttpRequest;a.open('GET','/en.fancy-search-data.bc53ccf067231fe36b594cb1f21786a507491cc1970ed260854abd4ca8ff0712.json',!0),a.onload=function(){var b,d;a.status>=200&&a.status<400?(b=JSON.parse(a.responseText),lunr.tokenizer.separator=/[\s\-\_]+/,d=lunr(function(){this.ref('id'),this.field('title',{boost:200}),this.field('content',{boost:2}),this.field('relUrl'),this.metadataWhitelist=['position'];for(var a in b)this.add({id:a,title:b[a].title,content:b[a].content,relUrl:b[a].relUrl})}),c(d,b)):console.log('Error loading ajax request. Request status:'+a.status)},a.onerror=function(){console.log('There was a connection error')},a.send()}function c(c,d){var c=c,b,e,k,g,f;d=d,b=document.getElementById('search-input'),e=document.getElementById('search-results'),k=document.getElementById('book-search'),f=0;function j(){document.documentElement.classList.add('search-active')}function h(){document.documentElement.classList.remove('search-active')}function i(){var a,i,m,k,l;if(f++,a=b.value,a===''?h():(j(),window.scroll(0,-1),setTimeout(function(){window.scroll(0,0)},0)),a===g)return;if(g=a,e.innerHTML='',a==='')return;i=c.query(function(b){var c=lunr.tokenizer(a);b.term(c,{boost:10}),b.term(c,{wildcard:lunr.Query.wildcard.LEADING|lunr.Query.wildcard.TRAILING})}),i.length==0&&a.length>2&&(m=lunr.tokenizer(a).filter(function(a,b){return a.str.length<20}),m.length>0&&(i=c.query(function(b){b.term(m,{editDistance:Math.round(Math.sqrt(a.length/2-1))})}))),i.length==0?(k=document.createElement('div'),k.classList.add('search-no-result'),k.innerText='No results found',e.appendChild(k)):(l=document.createElement('ul'),l.classList.add('search-results-list'),e.appendChild(l),n(l,i,0,10,100,f));function n(h,b,c,d,e,g){if(g!=f)return;for(var a=c;a<c+d;a++){if(a==b.length)return;p(h,b[a])}setTimeout(function(){n(h,b,c+d,d,e,g)},e)}function p(G,E){var b=d[E.ref],B=document.createElement('li'),q,r,n,s,A,u,D,v,j,f,t,m,e,c,l,k,y,x,i,h,a,g,C,z,F,p,w;B.classList.add('search-results-list-item'),G.appendChild(B),q=document.createElement('a'),q.classList.add('search-result'),q.setAttribute('href',b.url),B.appendChild(q),r=document.createElement('div'),r.classList.add('search-result-title'),q.appendChild(r),n=document.createElement('div'),n.classList.add('search-result-doc'),n.innerHTML='<svg viewBox="0 0 24 24" class="search-result-icon"><use xlink:href="#svg-doc"></use></svg>',r.appendChild(n),s=document.createElement('div'),s.classList.add('search-result-doc-title'),s.innerHTML=b.doc,n.appendChild(s),A=s,b.doc!=b.title&&(n.classList.add('search-result-doc-parent'),u=document.createElement('div'),u.classList.add('search-result-section'),u.innerHTML=b.title,r.appendChild(u),A=u),D=E.matchData.metadata,v=[],j=[];for(f in D){if(t=D[f],t.title){m=t.title.position;for(e in m)v.push(m[e])}if(t.content){m=t.content.position;for(e in m){c=m[e],l=c[0],k=c[0]+c[1],y=!0,x=!0;for(e=0;e<5;e++){if(i=b.content.lastIndexOf(' ',l-2),h=b.content.lastIndexOf('. ',l-2),h>=0&&h>i){l=h+1,y=!1;break}if(i<0){l=0,y=!1;break}l=i+1}for(e=0;e<10;e++){if(i=b.content.indexOf(' ',k+1),h=b.content.indexOf('. ',k+1),h>=0&&h<i){k=h,x=!1;break}if(i<0){k=b.content.length,x=!1;break}k=i}j.push({highlight:c,previewStart:l,previewEnd:k,ellipsesBefore:y,ellipsesAfter:x})}}}if(v.length>0&&(v.sort(function(a,b){return a[0]-b[0]}),A.innerHTML='',o(A,b.title,0,b.title.length,v)),j.length>0){j.sort(function(a,b){return a.highlight[0]-b.highlight[0]}),a=j[0],g={highlight:[a.highlight],previewStart:a.previewStart,previewEnd:a.previewEnd,ellipsesBefore:a.ellipsesBefore,ellipsesAfter:a.ellipsesAfter},C=[g];for(f=1;f<j.length;f++)a=j[f],g.previewEnd<a.previewStart?(g={highlight:[a.highlight],previewStart:a.previewStart,previewEnd:a.previewEnd,ellipsesBefore:a.ellipsesBefore,ellipsesAfter:a.ellipsesAfter},C.push(g)):(g.highlight.push(a.highlight),g.previewEnd=a.previewEnd,g.ellipsesAfter=a.ellipsesAfter);z=document.createElement('div'),z.classList.add('search-result-previews'),q.appendChild(z),F=b.content;for(f=0;f<Math.min(C.length,3);f++)c=C[f],p=document.createElement('div'),p.classList.add('search-result-preview'),z.appendChild(p),c.ellipsesBefore&&p.appendChild(document.createTextNode('... ')),o(p,F,c.previewStart,c.previewEnd,c.highlight),c.ellipsesAfter&&p.appendChild(document.createTextNode(' ...'))}w=document.createElement('span'),w.classList.add('search-result-rel-url'),w.innerText=b.relUrl,r.appendChild(w)}function o(d,f,i,j,g){var c=i,h,b,a,e;for(h in g)b=g[h],a=document.createElement('span'),a.innerHTML=f.substring(c,b[0]),d.appendChild(a),c=b[0]+b[1],e=document.createElement('span'),e.classList.add('search-result-highlight'),e.innerHTML=f.substring(b[0],c),d.appendChild(e);a=document.createElement('span'),a.innerHTML=f.substring(c,j),d.appendChild(a)}}a.addEvent(b,'focus',function(){setTimeout(i,0)}),a.addEvent(b,'keyup',function(a){switch(a.keyCode){case 27:b.value='';break;case 38:case 40:case 13:a.preventDefault();return}i()}),a.addEvent(b,'keydown',function(c){var a,e,b,d;switch(c.keyCode){case 38:c.preventDefault(),a=document.querySelector('.search-result.active'),a&&(a.classList.remove('active'),a.parentElement.previousSibling&&(e=a.parentElement.previousSibling.querySelector('.search-result'),e.classList.add('active')));return;case 40:c.preventDefault(),a=document.querySelector('.search-result.active'),a?a.parentElement.nextSibling&&(b=a.parentElement.nextSibling.querySelector('.search-result'),a.classList.remove('active'),b.classList.add('active')):(b=document.querySelector('.search-result'),b&&b.classList.add('active'));return;case 13:c.preventDefault(),a=document.querySelector('.search-result.active'),a?a.click():(d=document.querySelector('.search-result'),d&&d.click());return}}),a.addEvent(document,'click',function(a){a.target!=b&&h()})}a.onReady(function(){b()})})(window.jtd=window.jtd||{})